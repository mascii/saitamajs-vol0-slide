<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>slide</title><meta property="og:title" content="slide"><meta property="og:type" content="article"><script defer="defer" src="/runtime.dc2db85780d1fa2254b3.bundle.js"></script><script defer="defer" src="/vendor.7ecef42e2663a0dd8290.bundle.js"></script><script defer="defer" src="/main.cf38506f1a152974796c.bundle.js"></script><link href="/vendor.7ecef42e2663a0dd8290.css" rel="stylesheet"><link href="/main.cf38506f1a152974796c.css" rel="stylesheet"><link rel="prefetch" as="script" href="/921.642c86dda06856c551c3.bundle.js"><style data-styled="active" data-styled-version="5.3.1"></style></head><body><div id="root"><div class="swiper-container swiper-container-initialized swiper-container-horizontal swiper-container-pointer-events" id="main-slides"><div class="swiper-pagination"></div><div class="swiper-wrapper" id="swiper-wrapper-a63bab660e0f3495" aria-live="polite" style="transform: translate3d(0px, 0px, 0px);"><div class="swiper-slide title swiper-slide-active" data-hash="slide-1" role="group" aria-label="1 / 9" style="width: 1200px;"><div class="slide-internal-box"><h1><code>:focus-visible</code> と JavaScript</h1><div class="grid sns-box"><a href="https://twitter.com/mascii_k" class="account account-twitter" aria-label="account-twitter"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>mascii_k</a></div></div></div><div class="swiper-slide swiper-slide-next" data-hash="slide-2" role="group" aria-label="2 / 9" style="width: 1200px;"><div class="slide-internal-box"><h2>自己紹介</h2><img src="/83fe8faf81ce43d2884c.webp" class="my-sns-icon"><p class="my-name">ますきー (@mascii_k)</p><p>(株)ビザスク<br>フロントエンドエンジニア</p></div></div><div class="swiper-slide" data-hash="slide-3" role="group" aria-label="3 / 9" style="width: 1200px;"><div class="slide-internal-box"><h2><code>:focus-visible</code> とは？</h2><br><ul><li>キー操作時のみスタイルを当てるための疑似クラス</li></ul><br><div class=""><form class=""><label class="sc-hKgJUU iaqgHT"><input type="radio" name="radio" value="React"> React</label><label class="sc-hKgJUU iaqgHT"><input type="radio" name="radio" value="Vue"> Vue</label><label class="sc-hKgJUU iaqgHT"><input type="radio" name="radio" value="Angular"> Angular</label><label class="sc-hKgJUU iaqgHT"><input type="radio" name="radio" value="Svelte"> Svelte</label></form></div><br><ul><li>Chrome では 2020/10 から使えるようになった</li></ul><p class="p-caniuse"><img src="/3b4c41cec745dd2d595e.webp"><a href="https://caniuse.com/css-focus-visible">https://caniuse.com/css-focus-visible</a></p></div></div><div class="swiper-slide" data-hash="slide-4" role="group" aria-label="4 / 9" style="width: 1200px;"><div class="slide-internal-box"><h2><code>:focus-visible</code> のデモ</h2><br><div class=""><form class=""><label class="sc-hKgJUU iaqgHT"><input type="radio" name="radio" value="React"> React</label><label class="sc-hKgJUU iaqgHT"><input type="radio" name="radio" value="Vue"> Vue</label><label class="sc-hKgJUU iaqgHT"><input type="radio" name="radio" value="Angular"> Angular</label><label class="sc-hKgJUU iaqgHT"><input type="radio" name="radio" value="Svelte"> Svelte</label></form><br><form class=""><label class="sc-hKgJUU iaqgHT"><input type="radio" name="radio" class="sc-dlfnuX eQHiPQ" value="React"> React</label><label class="sc-hKgJUU iaqgHT"><input type="radio" name="radio" class="sc-dlfnuX eQHiPQ" value="Vue"> Vue</label><label class="sc-hKgJUU iaqgHT"><input type="radio" name="radio" class="sc-dlfnuX eQHiPQ" value="Angular"> Angular</label><label class="sc-hKgJUU iaqgHT"><input type="radio" name="radio" class="sc-dlfnuX eQHiPQ" value="Svelte"> Svelte</label></form><br><form class=""><input></form><br><form class=""><input class="sc-dlfnuX eQHiPQ"></form><br><form class=""><div class="sc-eCstlR hmZxFq"><label class="sc-gsTEea fdKwCC"><input type="radio" name="radio"><span class="sc-bdfBQB kKVOCU"></span>React</label></div><div class="sc-eCstlR hmZxFq"><label class="sc-gsTEea fdKwCC"><input type="radio" name="radio"><span class="sc-bdfBQB kKVOCU"></span>Vue</label></div><div class="sc-eCstlR hmZxFq"><label class="sc-gsTEea fdKwCC"><input type="radio" name="radio"><span class="sc-bdfBQB kKVOCU"></span>Angular</label></div><div class="sc-eCstlR hmZxFq"><label class="sc-gsTEea fdKwCC"><input type="radio" name="radio"><span class="sc-bdfBQB kKVOCU"></span>Svelte</label></div></form></div></div></div><div class="swiper-slide" data-hash="slide-5" role="group" aria-label="5 / 9" style="width: 1200px;"><div class="slide-internal-box"><h2>JS でもキー操作中であるかわかるか？</h2><br><p><code>document.querySelector()</code> で<br>
<code>:focus-visible</code> な要素を取得することができる<br></p><br><br>以下のようにしてキー操作中であるかがわかる:<pre class="  language-javascript" tabindex="0"><code class="  language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">hasFocusVisible</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">':focus-visible'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
    <span class="token comment">// :focus-visible 非対応ブラウザ</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></div><div class="swiper-slide" data-hash="slide-6" role="group" aria-label="6 / 9" style="width: 1200px;"><div class="slide-internal-box"><h2>ユースケース</h2><ul><li><label class="sc-gsTEea fdKwCC inline-block"><input type="radio" name=""><span class="sc-bdfBQB kKVOCU"></span></label>をクリックしたら、次に入力すべき入力欄にフォーカスが移る</li><li>キー操作で <label class="sc-gsTEea fdKwCC inline-block"><input type="radio" name=""><span class="sc-bdfBQB kKVOCU"></span></label>を選択するときは、入力欄にフォーカスが移らない</li></ul><p class="p-visasq-issue-new"><img src="/9826ad6fde66dc86a1d2.gif"><a href="https://service.visasq.com/issues/new/edit">ビザスクlite 公募案件作成画面</a></p></div></div><div class="swiper-slide" data-hash="slide-7" role="group" aria-label="7 / 9" style="width: 1200px;"><div class="slide-internal-box"><h2><code>:focus-visible</code> と WebComponents</h2><br><p>Shadow DOM によって <code>:focus-visible</code> な要素が隠蔽される</p><div class="p-demo-of-wired-elements">例: <a href="https://wiredjs.com/">Wired Elements</a><div class="sc-jSgvzq keQeTu"><wired-radio-group role="radiogroup" tabindex="0"><wired-radio name="React" class="wired-rendered">React</wired-radio><wired-radio name="Vue" class="wired-rendered">Vue</wired-radio><wired-radio name="Angular" class="wired-rendered">Angular</wired-radio><wired-radio name="Svelte" class="wired-rendered">Svelte</wired-radio></wired-radio-group></div></div><ul><li>Shadow DOM 内部の要素は <code>document.querySelector()</code> ではアクセスできない</li><li>つまり、<code>document.querySelector(':focus-visible')</code> が通用しない</li></ul></div></div><div class="swiper-slide" data-hash="slide-8" role="group" aria-label="8 / 9" style="width: 1200px;"><div class="slide-internal-box"><h2>WebComponents もキー操作中であるかわかるか？</h2><br><p>Shadow Root のモードが <code>closed</code> ではなく <code>open</code> であれば、Shadow Root の<br>
内部にアクセスすることで <code>:focus-visible</code> な要素を取得することができる<br></p><br><br>以下のようにしてキー操作中であるかがわかる:<pre class="  language-typescript" tabindex="0"><code class="  language-typescript"><span class="token keyword">const</span> hasFocusVisible <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// フォーカス中の要素またはコンポーネントを取得</span>
    <span class="token keyword">let</span> activeElement<span class="token operator">:</span> Element <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> document<span class="token punctuation">.</span>activeElement<span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>activeElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// フォーカス中の要素が :focus-visible なものであるか判定</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>activeElement<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">':focus-visible'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>activeElement<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      activeElement <span class="token operator">=</span> activeElement<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span>activeElement<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><ul><li><code>document.activeElement</code> でフォーカス中の要素またはコンポーネントを取得できる</li><li><code>Element#querySelector</code> は使うことがあったが <code>Element#matches</code> は初めて使った</li><li>この実装をして <code>&lt;iframe&gt;</code> 内部に <code>:focus-visible</code> な要素があるケースに気付いた</li></ul></div></div><div class="swiper-slide" data-hash="slide-9" role="group" aria-label="9 / 9" style="width: 1200px;"><div class="slide-internal-box"><h2>まとめ</h2><br><ul><li><code>:focus-visible</code> を JS からも活用できた</li><li>Shadow DOM が絡むとフォーカス周りは難しい</li></ul></div></div></div><span class="swiper-notification" aria-live="assertive" aria-atomic="true"></span></div></div></body></html>